# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ SessionProvider

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

```
src/app/layout.tsx (client component)
  ‚îî‚îÄ‚îÄ <Providers>                    ‚Üê SessionProvider
      ‚îî‚îÄ‚îÄ <I18nextProvider>
          ‚îî‚îÄ‚îÄ {children}             ‚Üê –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ NextAuth —Ö—É–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –•—É–∫ | –°—Ç–∞—Ç—É—Å | –ü—É—Ç—å |
|-----------|-----|--------|------|
| **Header.tsx** | `useSession()` | ‚úÖ –û–±—ë—Ä–Ω—É—Ç | `/src/app/components/Header.tsx` |
| **signin/page.tsx** | `signIn()` | ‚úÖ –û–±—ë—Ä–Ω—É—Ç | `/src/app/auth/signin/page.tsx` |
| **signup/page.tsx** | `signIn()` | ‚úÖ –û–±—ë—Ä–Ω—É—Ç | `/src/app/auth/signup/page.tsx` |

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SessionProvider

```tsx
// src/app/providers.tsx
<SessionProvider
  refetchInterval={5 * 60}        // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  refetchOnWindowFocus={true}     // –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –æ–∫–Ω–µ
>
  {children}
</SessionProvider>
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
```typescript
refetchInterval={5 * 60}  // 300 —Å–µ–∫—É–Ω–¥ = 5 –º–∏–Ω—É—Ç
```
- –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –≤–∫–ª–∞–¥–∫–µ
```typescript
refetchOnWindowFocus={true}
```
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞
- –°–µ—Å—Å–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –≤ Header

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ useSession –≤ Header

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ
http://localhost:3000

# –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
# –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ admin@fodisushi.com / admin123

# Header –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
# ‚úÖ "–ü—Ä–∏–≤–µ—Ç, Admin" (–∏–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
# ‚úÖ –ö–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ signIn –≤ —Ñ–æ—Ä–º–µ –≤—Ö–æ–¥–∞

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ
http://localhost:3000/auth/signin

# –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

# –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
# ‚úÖ –ü–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–í—Ö–æ–¥..."
# ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /profile –∏–ª–∏ /admin
# ‚úÖ Header –ø–æ–∫–∞–∂–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ signIn –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ
http://localhost:3000/auth/signup

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å –Ω–æ–≤—ã–º email

# –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
# ‚úÖ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥..."
# ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
# ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /profile
# ‚úÖ Header –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à–µ –∏–º—è
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

```bash
# 1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
# 2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
# 3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
# 4. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –æ–±—Ä–∞—Ç–Ω–æ

# –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥:
# üë§ Session loaded for: email@test.com (role: user)
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏

```tsx
"use client";

import { useSession } from "next-auth/react";

export function MyComponent() {
  const { data: session, status } = useSession();

  if (status === "loading") {
    return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  }

  if (status === "unauthenticated") {
    return <div>–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã</div>;
  }

  return (
    <div>
      <p>–ü—Ä–∏–≤–µ—Ç, {session.user.name}!</p>
      <p>Email: {session.user.email}</p>
      <p>–†–æ–ª—å: {session.user.role}</p>
    </div>
  );
}
```

### –ü—Ä–∏–º–µ—Ä 2: –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

```tsx
"use client";

import { useSession } from "next-auth/react";

export function AdminButton() {
  const { data: session } = useSession();

  if (session?.user.role !== "admin") {
    return null; // –°–∫—Ä—ã–≤–∞–µ–º –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  }

  return (
    <button>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
  );
}
```

### –ü—Ä–∏–º–µ—Ä 3: –í—Ö–æ–¥/–í—ã—Ö–æ–¥

```tsx
"use client";

import { signIn, signOut, useSession } from "next-auth/react";

export function AuthButton() {
  const { data: session } = useSession();

  if (session) {
    return (
      <button onClick={() => signOut()}>
        –í—ã–π—Ç–∏
      </button>
    );
  }

  return (
    <button onClick={() => signIn()}>
      –í–æ–π—Ç–∏
    </button>
  );
}
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö—É–∫–∏ NextAuth –≤–Ω–µ Providers

```tsx
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –≤–Ω–µ Providers
export default function SomeComponent() {
  const { data: session } = useSession(); // –û–®–ò–ë–ö–ê!
  // ...
}
```

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Providers

```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–Ω—É—Ç—Ä–∏ layout.tsx
<Providers>
  <SomeComponent /> {/* –∑–¥–µ—Å—å useSession —Ä–∞–±–æ—Ç–∞–µ—Ç */}
</Providers>
```

### üîí –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ auth()

```tsx
// –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–ù–ï "use client")
import { auth } from "@/auth";

export default async function ProfilePage() {
  const session = await auth(); // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  
  if (!session) {
    redirect("/auth/signin");
  }

  return <div>–ü—Ä–∏–≤–µ—Ç, {session.user.name}</div>;
}
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ |
|--------|------------------|--------------|------------|
| `useSession()` | –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | ‚úÖ –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å<br>‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | ‚ùå –¢–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ<br>‚ùå –¢—Ä–µ–±—É–µ—Ç SessionProvider |
| `await auth()` | –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | ‚úÖ SSR/SSG<br>‚úÖ SEO | ‚ùå –¢–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ<br>‚ùå –ù–µ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ |

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [x] SessionProvider –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `src/app/providers.tsx`
- [x] Providers –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ `src/app/layout.tsx`
- [x] Header –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useSession()` –≤–Ω—É—Ç—Ä–∏ Providers
- [x] –§–æ—Ä–º—ã –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `signIn()` –≤–Ω—É—Ç—Ä–∏ Providers
- [x] –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (5 –º–∏–Ω—É—Ç)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –æ–∫–Ω–µ –≤–∫–ª—é—á–µ–Ω–æ

---

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!** ‚úÖ
