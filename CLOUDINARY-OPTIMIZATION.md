# üì∏ Cloudinary Upload Optimization

## –ü—Ä–æ–±–ª–µ–º–∞
–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Cloudinary –±—ã–ª–∞ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ–π –∏–∑-–∑–∞:
1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–∂–∞—Ç–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ 5MB+)
2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è timeout –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

## –†–µ—à–µ–Ω–∏–µ

### 1. Frontend: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚úÖ

**–§–∞–π–ª:** `src/components/EditableImage.tsx`

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```typescript
const compressImage = (file: File): Promise<File> => {
  // 1. –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  // 2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –¥–æ –º–∞–∫—Å 1920px –ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ
  // 3. –°–∂–∏–º–∞–µ–º —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85% –≤ JPEG
  // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∂–∞—Ç—ã–π File
}
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **–î–æ:** –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ 5MB
- **–ü–æ—Å–ª–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∂–∞—Ç–æ–≥–æ ~300-800 KB
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** ~6-15x –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞

#### –õ–æ–≥–∏:
```
üì¶ Original: 4532 KB ‚Üí Compressed: 487 KB
```

---

### 2. Frontend API: Timeout –∑–∞—â–∏—Ç–∞ ‚úÖ

**–§–∞–π–ª:** `src/lib/api-client.ts`

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```typescript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 —Å–µ–∫—É–Ω–¥

const response = await fetch(`${API_BASE_URL}/api/upload`, {
  signal: controller.signal, // –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ timeout
});
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: **30 —Å–µ–∫—É–Ω–¥**
- –ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ timeout
- –û—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ Cloudinary –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

---

### 3. Backend: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç ‚úÖ

**–§–∞–π–ª:** `backend/src/services/cloudinary_service.rs`

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```rust
let client = reqwest::Client::builder()
    .timeout(Duration::from_secs(30))         // –û–±—â–∏–π timeout
    .connect_timeout(Duration::from_secs(10)) // Timeout –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    .pool_max_idle_per_host(10)               // –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    .build()
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (connection pooling)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π timeout –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞
- –ë—ã—Å—Ç—Ä–µ–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---

### 4. Backend: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ

**–§–∞–π–ª:** `backend/src/services/cloudinary_service.rs`

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```rust
üì§ Starting Cloudinary upload: photo.jpg (487.32 KB)
‚è±Ô∏è Cloudinary response received in 2.34s
‚úÖ Upload successful: photo.jpg ‚Üí https://... (total time: 2.34s)
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –í–∏–¥–∏–º —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏
- URL —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏

---

## –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```
–§–∞–π–ª: 4500 KB ‚Üí Cloudinary
–í—Ä–µ–º—è: ~15-30 —Å–µ–∫—É–Ω–¥
–ß–∞—Å—Ç–æ: timeout –∏–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–µ
```

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```
–§–∞–π–ª: 4500 KB ‚Üí –°–∂–∞—Ç–∏–µ ‚Üí 500 KB ‚Üí Cloudinary
–í—Ä–µ–º—è: ~2-5 —Å–µ–∫—É–Ω–¥
–°—Ç–∞–±–∏–ª—å–Ω–æ: –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—à–Ω–æ
```

## Speedup: **~6-10x –±—ã—Å—Ç—Ä–µ–µ** üöÄ

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. Progressive JPEG
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `compressImage`:
```typescript
canvas.toBlob(blob => {
  // ...
}, 'image/jpeg', 0.85);
// –î–æ–±–∞–≤–∏—Ç—å progressive: true –≤ Cloudinary preset
```

### 2. WebP —Ñ–æ—Ä–º–∞—Ç
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç WebP (–ª—É—á—à–µ —Å–∂–∞—Ç–∏–µ):
```typescript
const supportsWebP = canvas.toDataURL('image/webp').startsWith('data:image/webp');
const format = supportsWebP ? 'image/webp' : 'image/jpeg';
```

### 3. Lazy loading –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
```typescript
<Image 
  src={url} 
  loading="lazy" 
  placeholder="blur"
/>
```

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä—ã—Ç—å Dashboard ‚Üí Edit Mode
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–æ–µ —Ñ–æ—Ç–æ (3-5 MB)
3. –°–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å:
   - Frontend: `üì¶ Original: X KB ‚Üí Compressed: Y KB`
   - Backend logs: `üì§ Starting upload... ‚è±Ô∏è ... ‚úÖ Success`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏

---

## Cloudinary Settings

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Cloudinary Dashboard:

### Upload Preset: `portfolio`
- Mode: `unsigned`
- Folder: `portfolio/`
- Format: `auto` (–∞–≤—Ç–æ–≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞)
- Quality: `auto:good` (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–æ/—Ä–∞–∑–º–µ—Ä)
- Fetch format: `auto` (WebP –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)

### Transformations (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:
```
c_limit,w_1920,h_1920,q_auto:good,f_auto
```
- `c_limit` - –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å, —Ç–æ–ª—å–∫–æ —É–º–µ–Ω—å—à–∞—Ç—å
- `w_1920,h_1920` - –º–∞–∫—Å —Ä–∞–∑–º–µ—Ä
- `q_auto:good` - –∞–≤—Ç–æ–∫–∞—á–µ—Å—Ç–≤–æ
- `f_auto` - –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç (WebP/AVIF)

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ Shuttle –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º:
```bash
shuttle logs --follow
```

–ò—â–µ–º:
- `üì§ Starting Cloudinary upload`
- `‚è±Ô∏è Cloudinary response received`
- `‚úÖ Upload successful`
- `‚ùå Cloudinary upload failed` (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã)
