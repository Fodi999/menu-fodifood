# üó∫Ô∏è –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

## üìã –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –Ω–∞ `/auth/signin` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞:

| –†–æ–ª—å | –°—Ç—Ä–∞–Ω–∏—Ü–∞ | URL |
|------|----------|-----|
| **admin** | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | `/admin` |
| **user** | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | `/profile` |

---

## üîê –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

### `/profile` - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

**–§–∞–π–ª:** `src/app/profile/page.tsx`

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```typescript
const session = await auth();

if (!session?.user) {
  redirect("/auth/signin");
}
```

**–î–æ—Å—Ç—É–ø:**
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ª—é–±–∞—è —Ä–æ–ª—å)
- ‚ùå –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)
- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–ª–∏ (admin/user)

---

### `/admin` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–§–∞–π–ª:** `src/app/admin/page.tsx`

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```typescript
const session = await auth();

if (!session?.user || session.user.role !== "admin") {
  redirect("/auth/signin");
}
```

**–î–æ—Å—Ç—É–ø:**
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (`role === "admin"`)
- ‚ùå –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin`
- ‚ùå –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  - –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  - –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤
  - –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
- üì¶ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã
- üîó –°—Å—ã–ª–∫–∏ –Ω–∞:
  - `/admin/users` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - `/admin/orders` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏

---

## üéØ –ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ (signin)

**–§–∞–π–ª:** `src/app/auth/signin/page.tsx`

### –®–∞–≥ 1: –í–≤–æ–¥ credentials
```typescript
const result = await signIn("credentials", {
  email,
  password,
  redirect: false, // ‚úÖ –í–∞–∂–Ω–æ!
});
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```typescript
if (result?.error) {
  setError("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
  return;
}
```

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
```typescript
const response = await fetch("/api/auth/session");
const session = await response.json();
```

### –®–∞–≥ 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
```typescript
const redirectPath = session?.user?.role === "admin" 
  ? "/admin" 
  : "/profile";
```

### –®–∞–≥ 5: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```typescript
setTimeout(() => {
  router.push(redirectPath);
  router.refresh();
}, 800);
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### –í—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:

```
Email:    admin@fodisushi.com
Password: admin123
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
1. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ: "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ..."
2. ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin` —á–µ—Ä–µ–∑ 800ms
3. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
4. ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: `üîÑ Redirecting to: /admin`

---

### –í—Ö–æ–¥ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:

```
Email:    user@test.com
Password: user123
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
1. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ: "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ..."
2. ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/profile` —á–µ—Ä–µ–∑ 800ms
3. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
4. ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: `üîÑ Redirecting to: /profile`

---

### –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ `/admin` –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

```
1. –í–æ–π—Ç–∏ –∫–∞–∫ user@test.com
2. –í—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ /admin
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
1. ‚ùå Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø
2. ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin`
3. ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ middleware: "Access denied for user"

---

## üîó –í—Å–µ —Ä–æ—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—É–±–ª–∏—á–Ω—ã–µ (–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º):
- `/` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `/auth/signin` - –≤—Ö–æ–¥
- `/auth/signup` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/api/health` - health check
- `/api/products` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

### –¢—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- `/profile` - –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (–ª—é–±–∞—è —Ä–æ–ª—å)
- `/api/auth/session` - —Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è

### –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- `/admin` - –≥–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω–∫–∏
- `/admin/users` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `/admin/orders` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏

---

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /auth/signin   ‚îÇ
‚îÇ   (–≤—Ö–æ–¥)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ signIn()    ‚îÇ
   ‚îÇ —É—Å–ø–µ—à–Ω–æ?    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –†–æ–ª—å?    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ admin ‚îÇ   ‚îÇ  user   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ            ‚îÇ
    ‚ñº            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ /admin ‚îÇ  ‚îÇ /profile ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ `/auth/signin`
- –ù–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `redirect: false`**
   ```typescript
   // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
   await signIn("credentials", { email, password });
   
   // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   await signIn("credentials", { 
     email, 
     password, 
     redirect: false 
   });
   ```

2. **router.push() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**
   ```typescript
   // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
   router.push("/profile");
   
   // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   setTimeout(() => {
     router.push("/profile");
     router.refresh();
   }, 800);
   ```

3. **–°–µ—Å—Å–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NEXTAUTH_SECRET –Ω–∞ Vercel
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

---

### ‚ùå –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin` –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏—á–∏–Ω–∞:** –†–æ–ª—å –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const redirectPath = session?.user?.role === "admin" 
  ? "/admin" 
  : "/profile";
```

---

### ‚ùå Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/profile`

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ middleware

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `src/middleware.ts`:
```typescript
// /profile –¥–æ—Å—Ç—É–ø–µ–Ω –ª—é–±–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É
if (pathname === "/profile" && token) {
  return NextResponse.next();
}

// /admin —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
if (pathname.startsWith("/admin") && token?.role !== "admin") {
  return NextResponse.redirect(new URL("/auth/signin", request.url));
}
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

- [ ] `redirect: false` –≤ signIn()
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏: `session?.user?.role`
- [ ] –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç: admin ‚Üí /admin, user ‚Üí /profile
- [ ] setTimeout –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
- [ ] router.push() ‚Üí router.refresh()
- [ ] –ó–∞—â–∏—Ç–∞ `/admin` –≤ middleware
- [ ] –ó–∞—â–∏—Ç–∞ `/admin` –≤ —Å–∞–º–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ auth() –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìù –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ (admin):
```
üîê Attempting sign in...
üìä Sign in result: {ok: true, error: null}
‚úÖ Sign in successful!
üë§ Session after login: {user: {email: "admin@fodisushi.com", role: "admin"}}
üîÑ Redirecting to: /admin
```

### –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ (user):
```
üîê Attempting sign in...
üìä Sign in result: {ok: true, error: null}
‚úÖ Sign in successful!
üë§ Session after login: {user: {email: "user@test.com", role: "user"}}
üîÑ Redirecting to: /profile
```

### –ù–µ—É–¥–∞—á–Ω—ã–π –≤—Ö–æ–¥:
```
üîê Attempting sign in...
üìä Sign in result: {ok: false, error: "CredentialsSignin"}
‚ùå Sign in error: CredentialsSignin
```

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 5 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
