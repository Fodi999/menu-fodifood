# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ø–∞–¥–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å, –∞ —Å–Ω–æ–≤–∞ –≤–∏–¥–µ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏**
NextAuth –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT-—Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ cookies. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`router.push()`), cookies –º–æ–≥—É—Ç –Ω–µ —É—Å–ø–µ—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/profile`.

### 2. **Race condition –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º**
```
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí signIn() ‚Üí –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                       ‚Üì
              router.push("/profile") (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
                       ‚Üì
           Server rendering /profile (cookies –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å!)
                       ‚Üì
              redirect("/auth/signin") ‚ùå
```

### 3. **–†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É development –∏ production**
- **Development:** –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (–≤—Ä–µ–º—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies)
- **Production (Vercel):** –ë—ã—Å—Ç—Ä–µ–µ ‚Üí race condition –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —á–∞—â–µ

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `window.location.href` –≤–º–µ—Å—Ç–æ `router.push()`

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `window.location.href` –¥–µ–ª–∞–µ—Ç **–ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
- –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–Ω–æ–≤—ã–π HTTP-–∑–∞–ø—Ä–æ—Å** —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ cookies
- –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é –∏–∑ cookies
- Middleware –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–æ–¥:**
```typescript
const result = await signIn("credentials", {
  email: formData.email,
  password: formData.password,
  redirect: false, // –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤—Ä—É—á–Ω—É—é
});

if (result?.ok) {
  console.log("‚úÖ Auto-login successful, redirecting to profile...");
  
  // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ cookies
  window.location.href = "/profile";
}
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ú–µ—Ç–æ–¥ | –ö–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ–±–ª–µ–º—ã | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|-------|----------------|----------|--------------|
| `router.push()` | Development, –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏ | Race condition –Ω–∞ Vercel | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ |
| `signIn(..., { redirect: true })` | –í—Å–µ–≥–¥–∞ (NextAuth –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç) | –¢–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ UI | ‚úÖ –î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞ |
| `window.location.href` | –í—Å–µ–≥–¥–∞ (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞) | "–ú–æ—Ä–≥–∞–Ω–∏–µ" —Å—Ç—Ä–∞–Ω–∏—Ü—ã | ‚úÖ –î–ª—è –∞–≤—Ç–æ-–≤—Ö–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

## üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### 1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ (`/auth/signin`)**
```typescript
// NextAuth —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ redirect callback
await signIn("credentials", {
  email,
  password,
  redirect: true, // ‚úÖ NextAuth –¥–µ–ª–∞–µ—Ç –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ
  callbackUrl
});
```

### 2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`/auth/signup`)**
```typescript
// –°–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
const response = await fetch("/api/auth/register", { ... });

// –ü–æ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
const result = await signIn("credentials", {
  email,
  password,
  redirect: false // ‚ùå –ù–µ –¥–∞—ë–º NextAuth –¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç
});

// –î–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤—Ä—É—á–Ω—É—é —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
if (result?.ok) {
  window.location.href = "/profile"; // ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ cookies
}
```

## üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**`/profile/page.tsx`:**
```typescript
import { auth } from "@/auth";
import { redirect } from "next/navigation";

export default async function ProfilePage() {
  const session = await auth(); // –ß–∏—Ç–∞–µ—Ç cookies —Å —Å–µ—Ä–≤–µ—Ä–∞

  if (!session) {
    redirect("/auth/signin"); // –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí –Ω–∞ –≤—Ö–æ–¥
  }

  // –°–µ—Å—Å–∏—è –µ—Å—Ç—å ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
  return <div>–ü—Ä–∏–≤–µ—Ç, {session.user.name}!</div>;
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
npm run dev

# 1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/auth/signup
# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å –Ω–æ–≤—ã–º email
# 3. –î–æ–ª–∂–Ω—ã –ø–æ–ø–∞—Å—Ç—å –≤ /profile –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookies: F12 ‚Üí Application ‚Üí Cookies
#    - next-auth.session-token –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

### –ù–∞ Vercel:
```bash
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/auth/signup
# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ /profile
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–º—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Header
```

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`src/app/auth/signup/page.tsx`**
   - –£–¥–∞–ª—ë–Ω `useRouter` (–Ω–µ –Ω—É–∂–µ–Ω)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `window.location.href` –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `result?.ok`
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **`AUTO-LOGIN-FIX.md`**
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (—Å `router.push`)

3. **`REGISTRATION-LOGIN-FIX.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. **–ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ –ø–æ–¥—Ö–æ–¥—ã**
- –í—Ö–æ–¥ ‚Üí `signIn(..., { redirect: true })`
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí `signIn(..., { redirect: false })` + `window.location.href`

### 2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `result?.ok`**
```typescript
if (result?.ok) {
  // –£—Å–ø–µ—Ö
} else if (result?.error) {
  // –û—à–∏–±–∫–∞
} else {
  // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
}
```

### 3. **Cookies –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å SameSite=Lax**
NextAuth –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã cookies:
```
Set-Cookie: next-auth.session-token=...; Path=/; HttpOnly; SameSite=Lax
```

### 4. **NEXTAUTH_URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–º–µ–Ω–æ–º**
```env
# .env.local (–ª–æ–∫–∞–ª—å–Ω–æ)
NEXTAUTH_URL=http://localhost:3000

# Vercel Environment Variables
NEXTAUTH_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ ‚Üí `/profile` (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞)
‚úÖ –í—Ö–æ–¥ ‚Üí `/profile` –∏–ª–∏ `/admin` (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏)
‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ Vercel –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ cookies –∏ —Å–µ—Å—Å–∏–π

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** üöÄ
